{% load humanize %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donation Receipt - Khidmat Charitable Trust</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @page {
            size: A4;
            margin: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        body {
            font-family: "Inter", sans-serif;
            background: #fff;
            /* White background for PDF */
            font-size: 12px;
            /* Slightly smaller base font */
            color: #222;
        }

        .receipt {
            width: 100%;
            max-width: 210mm;
            /* A4 width */
            margin: 0 auto;
            background: #fff;
        }

        /* Header */
        .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 30px;
            /* Reduced padding */
            border-bottom: 2px solid #c62b23;
        }

        .receipt-header__left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .receipt-header__logo {
            height: 50px;
            /* Smaller logo */
        }

        .receipt-header__org h1 {
            font-size: 18px;
            /* Smaller title */
            font-weight: 700;
            color: #222;
            margin-bottom: 2px;
        }

        .receipt-header__org p {
            font-size: 10px;
            color: #666;
        }

        .receipt-header__right {
            text-align: right;
        }

        .receipt-header__title {
            font-size: 20px;
            /* Smaller title */
            font-weight: 700;
            color: #c62b23;
            margin-bottom: 5px;
        }

        .receipt-header__meta {
            font-size: 10px;
            color: #555;
            line-height: 1.4;
        }

        .receipt-header__meta strong {
            color: #222;
        }

        /* Body */
        .receipt-body {
            padding: 20px 30px;
            /* Reduced padding */
        }

        /* Row */
        .receipt-row {
            display: flex;
            border: 1px solid #e0e0e0;
            margin-bottom: -1px;
            page-break-inside: avoid;
            /* Prevent row breaking */
        }

        .receipt-row:first-child {
            border-radius: 6px 6px 0 0;
        }

        .receipt-row:last-child {
            border-radius: 0 0 6px 6px;
            margin-bottom: 20px;
            /* Reduced margin */
        }

        .receipt-label {
            width: 150px;
            /* Narrower label */
            padding: 10px 15px;
            /* Reduced padding */
            background: #f8f8f8;
            font-size: 11px;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-right: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }

        .receipt-value {
            flex: 1;
            padding: 10px 15px;
            /* Reduced padding */
            font-size: 13px;
            color: #222;
            display: flex;
            align-items: center;
        }

        .receipt-value--name {
            font-size: 15px;
            font-weight: 700;
        }

        .receipt-value--amount {
            font-size: 20px;
            font-weight: 700;
            color: #c62b23;
        }

        .receipt-value--success {
            color: #28a745;
            font-weight: 600;
        }

        /* Amount Section */
        .amount-section {
            background: #fff8e6;
            /* Fallback for gradient */
            border: 2px solid #f0d88a;
            border-radius: 8px;
            padding: 15px 20px;
            /* Reduced padding */
            margin-bottom: 20px;
            /* Reduced margin */
            display: flex;
            justify-content: space-between;
            align-items: center;
            page-break-inside: avoid;
        }

        .amount-section__left h4 {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 3px;
        }

        .amount-section__value {
            font-size: 28px;
            /* Smaller amount */
            font-weight: 700;
            color: #c62b23;
        }

        .amount-section__words {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }

        .amount-section__purpose {
            background: #c62b23;
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        /* Section Title */
        .section-title {
            font-size: 11px;
            font-weight: 700;
            color: #c62b23;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            /* Reduced margin */
            margin-top: 5px;
        }

        /* Tax Box */
        .tax-box {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-left: 4px solid #28a745;
            border-radius: 6px;
            padding: 12px 18px;
            /* Reduced padding */
            margin-bottom: 15px;
            /* Reduced margin */
            page-break-inside: avoid;
        }

        .tax-box h4 {
            font-size: 12px;
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tax-box p {
            font-size: 10px;
            color: #555;
            line-height: 1.4;
        }

        /* QR Section */
        .qr-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 12px 18px;
            /* Reduced padding */
            margin-bottom: 15px;
            page-break-inside: avoid;
        }

        .qr-section__left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .qr-section__code {
            width: 120px;
            /* 20% lar`ger QR */
            height: 120px;
            background: #fff;
            padding: 4px;
            border: 1px solid #ddd;
        }

        .qr-section__code img {
            width: 100%;
            height: 100%;
        }

        .qr-section__text h4 {
            font-size: 12px;
            font-weight: 700;
            color: #222;
            margin-bottom: 2px;
        }

        .qr-section__text p {
            font-size: 10px;
            color: #888;
        }

        .qr-section__text a {
            color: #c62b23;
            font-weight: 600;
            text-decoration: none;
            font-size: 11px;
        }

        /* Share Buttons */
        .qr-section__right {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-right: 15px;
            /* Shift icons left */
        }

        .share-btn {
            width: 32px;
            height: 32px;
            min-width: 32px;
            /* Prevent shrinking */
            min-height: 32px;
            border-radius: 50%;
            border: none;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            flex-shrink: 0;
            /* Crucial */
            padding: 0;
            /* Remove default padding */
        }

        .share-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .share-btn--wa {
            background: #25D366;
        }

        .share-btn--fb {
            background: #1877F2;
        }

        .share-btn--ig {
            background: #E1306C;
        }

        .share-btn--x {
            background: #000;
        }


        .share-btn--yt {
            background: #FF0000;
        }


        /* Impact */
        .impact-box {
            background: #fff5f5;
            border-left: 4px solid #c62b23;
            padding: 12px 18px;
            /* Reduced padding */
            margin-bottom: 15px;
            /* Reduced margin */
            page-break-inside: avoid;
        }

        .impact-box p {
            font-size: 11px;
            color: #555;
            line-height: 1.5;
        }

        /* Footer */
        .receipt-footer {
            background: #2e2e2e;
            padding: 15px 30px;
            /* Reduced padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            page-break-inside: avoid;
            position: absolute;
            /* Fix footer to bottom if needed, but flex flow is safer for single page variable height */
            bottom: 0;
            left: 0;
            width: 100%;
        }

        /* If content overflows, footer might overlap, but for single page goal, we want it at bottom of that page. 
           However, absolute positioning can supply issues if content is too long. 
           Let's just keep it in flow but ensure it doesn't break. */
        .receipt-footer {
            position: static;
            margin-top: auto;
        }

        .receipt-footer__left p {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2px;
        }

        .receipt-footer__right p {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 2px;
        }

        .receipt-footer__website {
            font-size: 11px;
            font-weight: 700;
            color: #f4d03f;
        }

        /* WeasyPrint Specifics */
        @media print {}
    </style>
</head>

<body>

    <div class="receipt">

        <!-- Header -->
        <div class="receipt-header">
            <div class="receipt-header__left">
                <img src="https://khidmattrust.org/static/images/khidmat-logo.png" alt="Khidmat Trust"
                    class="receipt-header__logo">
                <div class="receipt-header__org">
                    <h1>Khidmat Charitable Trust</h1>
                    <p>Reg. No: E-19852 (Mumbai) | PAN: AAATK7563N</p>
                </div>
            </div>
            <div class="receipt-header__right">
                <h2 class="receipt-header__title">DONATION RECEIPT</h2>
                <div class="receipt-header__meta">
                    <strong>Receipt No:</strong> {{donation.receipt_number}}<br>
                    <strong>Date:</strong> {{ donation.paid_at|date:"d F Y" }}
                </div>
            </div>
        </div>

        <!-- Body -->
        <div class="receipt-body">

            <!-- Amount Section -->
            <div class="amount-section">
                <div class="amount-section__left">
                    <h4>Amount Received</h4>
                    <div class="amount-section__value">₹{{ donation.amount|floatformat:2|intcomma }}</div>
                    <p class="amount-section__words">{{ donation.amount_in_words }}</p>
                </div>
                <div class="amount-section__right">
                    <span class="amount-section__purpose">
                        {{ donation.donation_type }}
                    </span>
                </div>
            </div>

            <!-- Donor Details -->
            <p class="section-title">Donor Details</p>
            <div class="receipt-row">
                <div class="receipt-label">Donor Name</div>
                <div class="receipt-value receipt-value--name">{{ donation.name }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Email</div>
                <div class="receipt-value">{{ donation.email }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Mobile</div>
                <div class="receipt-value">+91 {{ donation.mobile }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">PAN Number</div>
                <div class="receipt-value">{{ donation.pan_number }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Address</div>
                <div class="receipt-value">{{ donation.address }}, {{ donation.city }}, {{ donation.state }} - {{
                    donation.pincode }}, {{ donation.country }}</div>
            </div>

            <!-- Transaction Details -->
            <p class="section-title">Transaction Details</p>
            <div class="receipt-row">
                <div class="receipt-label">Transaction ID</div>
                <div class="receipt-value">{{ donation.transaction_id }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Payment Mode</div>
                <div class="receipt-value">{{ donation.payment_method }}</div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Date & Time</div>
                <div class="receipt-value">
                    {% if donation.paid_at %}
                    {{ donation.paid_at|date:"d F Y, g:i A" }}
                    {% else %}
                    Not Paid Yet
                    {% endif %}
                </div>
            </div>
            <div class="receipt-row">
                <div class="receipt-label">Status</div>
                {% if donation.payment_status == "SUCCESS" %}
                <div class="receipt-value receipt-value--success">
                    ✓ Payment Successful
                </div>
                {% endif %}
            </div>

            <br>

            <!-- Tax Info -->
            <div class="tax-box">
                <h4><i class="fas fa-file-invoice-dollar"></i> 80G Tax Exemption</h4>
                <p>
                    This donation is eligible for 50% tax exemption under <strong>Section 80G</strong> of the Income Tax
                    Act, 1961.<br>
                    <strong>80G Registration:</strong> E-19852 | <strong>PAN:</strong> AAATK7563N |
                    <strong>Validity:</strong> Perpetual
                </p>
            </div>

            <!-- Impact -->
            <div class="impact-box">
                <p>
                    <strong>Your Impact:</strong> {{ donation.impact_message }}
                </p>
            </div>

            <!-- QR Section -->
            <div class="qr-section">
                <div class="qr-section__left">
                    <div class="qr-section__code">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://khidmattrust.org/donate"
                            alt="QR Code">
                    </div>
                    <div class="qr-section__text">
                        <h4>Inspire Others</h4>
                        <p>Scan to donate</p>
                        <a href="https://khidmattrust.org/donate">khidmattrust.org/donate</a>
                    </div>
                </div>
                <div class="qr-section__right">
                    <!-- Facebook -->
                    <a href="https://www.facebook.com/share/1Ui9svyXQ9/" target="_blank" class="share-btn share-btn--fb" title="Facebook">
                        <svg viewBox="0 0 320 512" width="14" height="14" fill="white">
                            <path
                                d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z" />
                        </svg>
                        <span class="sr-only">Facebook</span>
                    </a>

                    <!-- Instagram -->
                    <a href="https://www.instagram.com/khidmat_trust?igsh=MXU0eHg3NXNva245cw==" target="_blank" class="share-btn share-btn--ig" title="Instagram">
                        <svg viewBox="0 0 448 512" width="14" height="14" fill="white">
                            <path
                                d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.5 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" />
                        </svg>
                        <span class="sr-only">Instagram</span>
                    </a>

                    <!-- Twitter / X -->
                    <a href="https://x.com/trust_khidmat?s=09" target="_blank" class="share-btn share-btn--x" title="Twitter">
                        <svg viewBox="0 0 512 512" width="14" height="14" fill="white">
                            <path
                                d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z" />
                        </svg>
                        <span class="sr-only">Twitter</span>
                    </a>

                    <!-- YouTube -->
                    <a href="https://youtube.com/@khidmattrust?si=CQkQ9vSkc3UAO2Zp" target="_blank" class="share-btn share-btn--yt" title="Youtube">
                        <svg viewBox="0 0 576 512" width="16" height="16" fill="white">
                            <path
                                d="M549.655 124.998c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 76.401c-23.497 6.321-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 82.116z" />
                        </svg>
                        <span class="sr-only">Youtube</span>
                    </a>

                    <!-- WhatsApp -->
                    <a href="https://whatsapp.com/channel/0029Vb8jn7p7IUYWYABK8B0t" target="_blank" class="share-btn share-btn--wa" title="WhatsApp">
                        <svg viewBox="0 0 448 512" width="16" height="16" fill="white">
                            <path
                                d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
                        </svg>
                        <span class="sr-only">WhatsApp</span>
                    </a>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="receipt-footer">
            <div class="receipt-footer__left">
                <p><strong>Khidmat Charitable Trust</strong></p>
                <p>P.T Mane Udyan, Mirza Galib Marg, Nagpada, Mumbai - 400008</p>
                <p>Phone: +91 86579 70797 | Email: info@khidmattrust.org</p>
            </div>
            <div class="receipt-footer__right">
                <p>This is a computer-generated receipt.</p>
                <p>No signature required.</p>
                <span class="receipt-footer__website">www.khidmattrust.org</span>
            </div>
        </div>

    </div>

</body>

</html>